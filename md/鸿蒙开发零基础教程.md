## HarmonyOS 是什么？

HarmonyOS 是华为开发的、一款面向未来的、全场景分布式智慧操作系统，将逐步覆盖 1 + 8 + N 全场景终端设备。

对于消费者而言，HarmonyOS 用一个“统一的软件系统”，从根本上解决消费者面对大量智能终端体验割裂的问题，为消费者带来统一、便利、安全的智慧化全场景体验。

对于开发者而言，HarmonyOS 通过多种分布式技术，整合不同终端硬件能力，形成一个虚拟的“超级终端”。应用开发者可基于开发者开发应用，聚焦上层业务逻辑，无需关注硬件差异，设备开发者可以调用其他终端能力，带来基于“超级终端”的创新服务体验。

- “1” 代表智能手机
- “8” 代表 PC、平板、手表、智慧屏、AI 音箱、耳机、AR/VR 眼镜、车机
- “N” 代表 IoT 生态产品

**万物互联、万物智能、全场景智慧生态**

## 开发前准备工作

1. 注册开发者账号

开发者需要 [注册](https://id1.cloud.huawei.com/CAS/portal/userRegister/regbyphone.html?) 华为开发者联盟帐号，并且实名认证才能享受联盟开放的各类能力和服务。

2. 环境搭建

- 安装最新版 [DevEco Studio](https://developer.harmonyos.com/cn/develop/deveco-studio)
- [配置开发环境](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/environment_config-0000001052902427-V3)

3. 创建项目

打开 DevEco Studio，在首页单击 Create Project，选择创建 Application 应用，选择 “Empty Ability” 模板，然后单击 Next。

![创建项目](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\创建项目.png)

可以选择修改或使用默认的 Project Name、Bundle Name，选择项目要保存的位置（Save location），其他选项保持默认值就好，单击 Finsh。

![创建项目2](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\创建项目2.png)

4. 运行调试

创建好的 Hello World 工程可以在真机和模拟器中运行，下面介绍一下如何使用模拟器运行。

单击 Tools > Device Manager。

![模拟器运行1](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行1.png)

选择使用 Local Emulator 或 Remote Emulator，Remote Emulator 需要登录，资源比较有限，不一定时时有资源给我们使用，且远程模拟器调试编译运行没有本地快，最好还是使用本地模拟器。下载本地模拟器占用需要几个 G 的内存，先选择本地模拟器需要下载的路径，单击 New Emulator。

![模拟器运行2](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行2.png)

单击 Next。

![模拟器运行3](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行3.png)

上面创建的项目选择的是 api9，模拟器也要选择 api9，第一次创建模拟器需要先下载 api9，因为模拟器占用内存比较大，下载时间会比较长，需耐心等待。然后单击 Next。

![模拟器运行4](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行4.png)

单击 Finsh。

![模拟器运行5](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行5.png)

创建成功后会弹出弹窗，点击 OK。

![模拟器运行6](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行6.png)

设备列表中会展示刚才创建好模拟器。

![模拟器运行7](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行7.png)

单击 Actions 列的绿色三角图标。

![模拟器运行8](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行8.png)

模拟器运行成功效果。

![模拟器运行9](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行9.png)

单击右上角的绿色三角图标运行项目。

![模拟器运行10](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行10.png)

项目运行成功效果。

![模拟器运行11](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\模拟器运行11.png)

## UI 开发

基本概念：

- UI：即用户界面。开发者可以将应用的用户界面设计为多个功能页面，每个页面进行单独的文件管理，并通过页面路由 API 完成页面间的调度管理如跳转、回退等操作，以实现应用内的功能解耦。

- 组件：UI 构建与显示的最小单位，如列表、网格、按钮、单选框、进度条、文本等。开发者通过多种组件的组合，构建出满足自身应用诉求的完整界面。

### 方舟开发框架(ArkUI)

方舟开发框架(ArkUI)为 HarmonyOS 应用的 UI 开发提供了完整的基础设施，包括简洁的 UI 语法、丰富的 UI 功能（组件、布局、动画以及交互事件），以及实时界面预览工具等，可以支持开发者进行可视化界面开发。

**两种开发范式**

针对不同的应用场景及技术背景，方舟开发框架提供了两种开发范式，分别是基于 ArkTS 的声明式开发范式（简称“声明式开发范式”）和兼容 JS 的类 Web 开发范式（简称“类 Web 开发范式”）。

- 声明式开发范式：采用基于 TypeScript 声明式 UI 语法扩展而来的 ArkTS 语言，从组件、动画和状态管理三个维度提供 UI 绘制能力。

- 类 Web 开发范式：采用经典的 HML、CSS、JavaScript 三段式开发方式。该范式更符合于 Web 前端开发者的使用习惯，便于快速将已有的 Web 应用改造成方舟开发框架应用。

由于声明式开发范式性能更佳，且 Stage 模型（HarmonyOS 应用模型）是官方以后主推且支持更新的模型，而 Stage 模型只支持声明式开发范式，而且官方也推荐使用声明式开发范式，所以本文接下来只介绍声明式开发范式。

### 声明式开发范式

![声明式开发范式的基本组成](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\声明式开发范式的基本组成.png)

上图标注了声明式开发范式的基本组成，具体说明如下：

**装饰器**
用来装饰类、结构体、方法以及变量，赋予其特殊的含义，如上述示例中 @Entry 、 @Component 、 @State 都是装饰器。具体而言， @Component 表示这是个自定义组件； @Entry 则表示这是个入口组件； @State 表示组件中的状态变量，此状态变化会引起 UI 变更。

**自定义组件**
可复用的 UI 单元，可组合其它组件，如上述被 @Component 装饰的 struct Hello。

**UI 描述**
声明式的方式来描述 UI 的结构，如上述 build() 方法内部的代码块。

**内置组件**
框架中默认内置的基础和布局组件，可直接被开发者调用，比如示例中的 Column、Text、Divider、Button。

**事件方法**
用于添加组件对事件的响应逻辑，统一通过事件方法进行设置，如跟随在 Button 后面的 onClick()。

**属性方法**
用于组件属性的配置，统一通过属性方法进行设置，如 fontSize()、width()、height()、color() 等，可通过链式调用的方式设置多项属性。

### 组件

上面提到了组件是用户界面构建与显示的最小单位，通过各类组件的组合构建出完整的界面。在基于 ArkTS 的声明式开发范式中，提供了很多的系统内置组件，文本、按钮、输入框、下拉框、日期选择器、图片等。

```ts
@Entry
@Component
struct Index {
  build() {
    Column({ space: 10 }) {
      Text('Hello World')
      Button('OK')
      TextInput()
      Select([
        { value: '张三' },
        { value: '李四' },
      ])
        .selected(0)
        .value('张三')
    }
    .width('100%')
    .height('100%')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Center)
  }
}
```

上面的示例代码中，页面中包含了一个文本、一个按钮、一个输入框和一个下拉框组件，运行效果如下：

![内置组件](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\内置组件.png)

### 动画

动画的原理是在一个时间段内，多次改变 UI 外观，由于人眼会产生视觉暂留，所以最终看到的就是一个“连续”的动画。UI 的一次改变称为一个动画帧，对应一次屏幕刷新，而决定动画流畅度的一个重要指标就是帧率 FPS（Frame Per Second），即每秒的动画帧数，帧率越高则动画就会越流畅。

ArkUI 中，产生动画的方式是改变属性值且指定动画参数。动画参数包含了如动画时长、变化规律（即曲线）等参数。当属性值发生变化后，按照动画参数，从原来的状态过渡到新的状态，即形成一个动画。

```ts
@Entry
@Component
struct Index {
  @State bgColor: Color = Color.Blue

  build() {
    Column() {
      Button('改变容器的背景颜色')
        .fontColor(Color.White)
        .onClick(() => {
          if (this.bgColor === Color.Blue) {
            this.bgColor = Color.Green
          } else {
            this.bgColor = Color.Blue
          }
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
    .backgroundColor(this.bgColor)
    .animation({ duration: 1000, curve: Curve.EaseInOut })
  }
}
```

上面的示例代码是改变界面元素的背景颜色的过渡动画。

```ts
@Entry
@Component
struct Index {
  @State flag: boolean = false

  build() {
    Column({ space: 10 }) {
      Button(`${this.flag ? '隐藏' : '显示'}`)
        .fontColor(Color.White)
        .onClick(() => {
          animateTo({ duration: 1000, curve: Curve.EaseInOut }, () => {
            this.flag = !this.flag
          })
        })
      if (this.flag) {
        Column()
          .width(200)
          .height(200)
          .backgroundColor(Color.Pink)
          .transition({ type: TransitionType.Insert, opacity: 0, scale: { x: 0, y: 0 } })
          .transition({ type: TransitionType.Delete, opacity: 0, scale: { x: 0, y: 0 } })
      }
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
  }
}
```

上面的示例代码是界面元素显示或隐藏过程中的过渡动画。

### 路由与导航

**页面路由**

页面路由指在应用程序中实现不同页面之间的跳转和数据传递。HarmonyOS 提供了 router 模块来完成对应的功能。

页面跳转：

- `router.pushUrl()`

页面返回：

- `router.back()`

```ts
// Home 页
import router from '@ohos.router';

@Entry
@Component
struct Home {
  build() {
    Column({ space: 10 }) {
      Text('Home Page')
        .fontSize(50)
      Button('Jump to Detail')
        .fontColor(30)
        .onClick(() => {
          router.pushUrl({ url: 'pages/Detail' })
        })
    }
    .width('100%')
    .height('100%')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Center)
  }
}
```

```ts
// Detail 页
import router from '@ohos.router';

@Entry
@Component
struct Detail {
  build() {
    Column({ space: 10 }) {
      Text('Detail Page')
        .fontSize(50)
      Button('Back')
        .fontSize(30)
        .onClick(() => {
          router.back()
        })
    }
    .width('100%')
    .height('100%')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Center)
  }
}
```

上面的示例代码是一个 Home 页面单击 `Jump to Detail` 按钮跳转到 Detail 页面，Detail 页面单击 `Back` 按钮返回到 Home 页的简单示例。

**组件导航**

当页面信息较多时，为了让用户能够聚焦于当前显示的内容，需要对页面内容进行分类，提高页面空间利用率。Tabs 组件可以在一个页面内快速实现视图内容的切换，一方面提升查找信息的效率，另一方面精简用户单次获取到的信息量。

```ts
@Entry
@Component
struct Index {
  build() {
    Tabs({ barPosition: BarPosition.End }) {
      TabContent() {
        Text('首页的内容').fontSize(30)
      }
      .tabBar('首页')

      TabContent() {
        Text('推荐的内容').fontSize(30)
      }
      .tabBar('推荐')

      TabContent() {
        Text('发现的内容').fontSize(30)
      }
      .tabBar('发现')

      TabContent() {
        Text('我的内容').fontSize(30)
      }
      .tabBar("我的")
    }
  }
}
```

上面的示例代码是一个简单的 Tabs，运行效果如下：

![Tabs组件](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\Tabs组件.png)

```ts
@Entry
@Component
struct Index {
  @State currentIndex: number = 0

  @Builder TabBuilder(title: string, targetIndex: number, selectedImg: Resource, normalImg: Resource) {
    Column() {
      Image(this.currentIndex === targetIndex ? selectedImg : normalImg)
        .size({ width: 25, height: 25 })
      Text(title)
        .fontColor(this.currentIndex === targetIndex ? '#e92f4f' : '#6B6B6B')
    }
    .width('100%')
    .height(50)
    .justifyContent(FlexAlign.Center)
  }

  build() {
    Tabs({ barPosition: BarPosition.End }) {
      TabContent() {
        Text('首页的内容').fontSize(30)
      }
      .tabBar(this.TabBuilder('首页', 0, $r('app.media.ic_home_focus'), $r('app.media.ic_home_normal')))

      TabContent() {
        Text('新品的内容').fontSize(30)
      }
      .tabBar(this.TabBuilder('新品', 1, $r('app.media.ic_product_focus'), $r('app.media.ic_product_normal')))

      TabContent() {
        Text('购物车的内容').fontSize(30)
      }
      .tabBar(this.TabBuilder('购物车', 2, $r('app.media.ic_cart_focus'), $r('app.media.ic_cart_normal')))

      TabContent() {
        Text('我的内容').fontSize(30)
      }
      .tabBar(this.TabBuilder('我的', 3, $r('app.media.ic_personal_focus'), $r('app.media.ic_personal_normal')))
    }
    .onChange((index: number) => {
      this.currentIndex = index
    })
  }
}
```

上面的示例代码，跟实际的 App 应用的 Tab 很相似，运行效果如下：

![Tabs组件2](D:\my-code\mobile-terminal-project\harmonyos-project\harmonyosDemo\md\images\Tabs组件2.png)
